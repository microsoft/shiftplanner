# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  All Shifts Screen:
    Properties:
      OnVisible: "=Reset(dteDate_AllShifts);\r\n//Reset(togShowSamePosition_SwapShift_1);\r\n\r\n\r\n//Set Teams Gallery Items \r\nClearCollect(colTeams,Sort(\r\n    Filter(\r\n        AddColumns(\r\n            shiftplanner_shiftteams As ShiftTeam,\r\n            WithShiftTeamPosition,\r\n            LookUp(\r\n                AddColumns(\r\n                    'Shift Bookings'As ShiftBooking,\r\n                    ResourceName,\r\n                    ShiftBooking.Resource,\r\n                    TeamPositionRole,ShiftBooking.'Team Position'.Role.Name,\r\n                    TeamPositionRoleId,ShiftBooking.'Team Position'.Role.shiftplanner_role\r\n                ) As SB,\r\n                SB.'Team Position'.'Shift Team'.shiftplanner_shiftteam = ShiftTeam.shiftplanner_shiftteam \r\n                And SB.Date = dteDate_AllShifts.SelectedDate \r\n                //And SB.Resource.'Primary Email' <> varCurrentUser.Email\r\n                And !IsBlank(SB.ResourceName) \r\n                And SB.Status = 'Status (Shift Bookings)'.Active  // To filter Active status only\r\n                And SB.'Status Reason' = 'Status Reason (Shift Bookings)'.Published //And SB.'Status Reason' = 865420002 //To filter published only\r\n                \r\n                //And ((SB.'Team Position'.Role.shiftplanner_role = varSelectedShift.'Team Position'.Role.shiftplanner_role And togShowSamePosition_SwapShift_1.Checked) Or !togShowSamePosition_SwapShift_1.Checked) \r\n            )\r\n        ),\r\n        !IsBlank(WithShiftTeamPosition)\r\n    ),\r\n    'Shift Type'.Startdate\r\n));\r\n\r\n\r\n//Use collection for Filters - Refresh galleries on screen visible and change of date to avoid performance issue\r\nClearCollect(colMainTeams,colTeams);\r\n\r\n//Set collection for filter\r\nIf(\r\n    !IsBlank(colTeamFilter),\r\n    Clear(colTeamFilter)\r\n);\r\nSet(\r\n    varAllTeamValue,\r\n    \"All Teams\"\r\n);\r\nClearCollect(\r\n    colTeamFilter,\r\n    {Name: varAllTeamValue}\r\n);\r\nCollect(\r\n    colTeamFilter,\r\n    Sort(\r\n        RenameColumns(\r\n            ShowColumns(\r\n                colTeams,\r\n                Name\r\n            ),\r\n            mpa_name,\r\n            Name\r\n        ),\r\n        Name\r\n    )\r\n);"
    Children:
      - conMainContent_AllShifts:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            DropShadow: =DropShadow.None
            Height: =Parent.Height - cmpHeaderMobile_AllShifts.Height
            LayoutDirection: =LayoutDirection.Vertical
            PaddingBottom: =16
            PaddingLeft: |+
              =Switch(App.ActiveScreen.Size,
              5, (App.Width - 1580)/2,
              4, 20,
              3, 20,
              2, 20,
              1, 0
              )

            PaddingRight: |-
              =Switch(App.ActiveScreen.Size,
              5, (App.Width - 1580)/2,
              4, 20,
              3, 20,
              2, 20,
              1, 0
              )
            PaddingTop: =24
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =Parent.Width
            Y: '=cmpHeaderMobile_AllShifts.Height '
          Children:
            - conBodyContent_AllShifts:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  DropShadow: =DropShadow.None
                  FillPortions: =0
                  Height: |+
                    =//Parent.Height - conTitle_SwapShift.Height - Parent.PaddingTop - Parent.PaddingBottom
                    conFilter_AllShifts.Height
                  LayoutDirection: =LayoutDirection.Vertical
                  PaddingLeft: =16
                  PaddingTop: =16
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                  Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                Children:
                  - conFilter_AllShifts:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: |+
                          =//Parent.Height -Parent.PaddingTop
                          (conDate_AllShifts.Height  +conTeam_AllShifts.Height+10 + Self.LayoutGap )+30
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: =12
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingLeft '
                      Children:
                        - conDate_AllShifts:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              AlignInContainer: =AlignInContainer.SetByContainer
                              DropShadow: =DropShadow.None
                              FillPortions: =0
                              Height: =txtDate_AllShifts.Height + dteDate_AllShifts.Height + Self.LayoutGap
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutGap: =4
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Width: '=Parent.Width '
                            Children:
                              - txtDate_AllShifts:
                                  Control: Text@0.0.51
                                  Properties:
                                    AutoHeight: =true
                                    FontColor: =ColorValue(varTheme.neutralForeground1)
                                    Text: ="Date"
                                    Weight: ='TextCanvas.Weight'.Semibold
                                    Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                              - dteDate_AllShifts:
                                  Control: DatePicker@0.0.46
                                  Properties:
                                    AccessibleLabel: ="All Shift date"
                                    FontItalic: =
                                    Format: ='DatePickerCanvas.Format'.Short
                                    OnChange: |-
                                      =ClearCollect(colTeams,Sort(
                                          Filter(
                                              AddColumns(
                                                  shiftplanner_shiftteams As ShiftTeam,
                                                  WithShiftTeamPosition,
                                                  LookUp(
                                                      AddColumns(
                                                           'Shift Bookings'As ShiftBooking,
                                                          ResourceName,
                                                          ShiftBooking.Resource,
                                                           TeamPositionRole,ShiftBooking.'Team Position'.Role.Name,
                                                          TeamPositionRoleId,ShiftBooking.'Team Position'.Role.shiftplanner_role
                                                      ) As SB,
                                                      SB.'Team Position'.'Shift Team'.shiftplanner_shiftteam = ShiftTeam.shiftplanner_shiftteam 
                                                      And SB.Date = dteDate_AllShifts.SelectedDate
                                                      //And SB.Resource.'Primary Email' <> varCurrentUser.Email
                                                      And !IsBlank(SB.ResourceName) 
                                                      And SB.Status = 'Status (Shift Bookings)'.Active // To filter Active status only
                                                      And SB.'Status Reason' = 'Status Reason (Shift Bookings)'.Published
                                                      //And ((SB.'Team Position'.Role.shiftplanner_role = varSelectedShift.'Team Position'.Role.shiftplanner_role And togShowSamePosition_SwapShift_1.Checked) Or !togShowSamePosition_SwapShift_1.Checked) 
                                                  )
                                              ),
                                              !IsBlank(WithShiftTeamPosition) //And (Name = cboTeam_SwapShift.Selected.Name Or cboTeam_SwapShift.Selected.Name = varAllTeamValue Or IsBlank(cboTeam_SwapShift.Selected.Name))
                                          ),
                                          Name
                                      ));

                                      //Use collection for Filters - Refresh galleries on screen visible and change of date to avoid performance issue
                                      ClearCollect(colMainTeams,colTeams);

                                      //Set collection for filter
                                      If(
                                          !IsBlank(colTeamFilter),
                                          Clear(colTeamFilter)
                                      );
                                      Set(
                                          varAllTeamValue,
                                          "All Teams"
                                      );
                                      ClearCollect(
                                          colTeamFilter,
                                          {Name: varAllTeamValue}
                                      );
                                      Collect(
                                          colTeamFilter,
                                          Sort(
                                              RenameColumns(
                                                  ShowColumns(
                                                      colTeams,
                                                      Name
                                                  ),
                                                  mpa_name,
                                                  Name
                                              ),
                                              Name
                                          )
                                      );
                                    SelectedDate: =Today()
                                    Width: =Parent.Width
                        - conTeam_AllShifts:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              AlignInContainer: =AlignInContainer.SetByContainer
                              DropShadow: =DropShadow.None
                              FillPortions: =0
                              Height: =txtTeam_AllShifts.Height + cmbTeam_AllShifts.Height + Self.LayoutGap
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutGap: =4
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Width: =Parent.Width
                            Children:
                              - txtTeam_AllShifts:
                                  Control: Text@0.0.51
                                  Properties:
                                    AutoHeight: =true
                                    FontColor: =ColorValue(varTheme.neutralForeground1)
                                    Text: ="Team"
                                    Weight: ='TextCanvas.Weight'.Semibold
                                    Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                              - cmbTeam_AllShifts:
                                  Control: ComboBox@0.0.51
                                  Properties:
                                    AccessibleLabel: ="Team Filter"
                                    BasePaletteColor: =RGBA(5, 102, 178, 1)
                                    DefaultSelectedItems: =First(colTeamFilter)
                                    FontItalic: =
                                    Items: |+
                                      =colTeamFilter
                                    OnChange: |-
                                      =/*ClearCollect(colTeams,Sort(
                                          Filter(
                                              AddColumns(
                                                  shiftplanner_shiftteams As ShiftTeam,
                                                  WithShiftTeamPosition,
                                                  LookUp(
                                                      AddColumns(
                                                          'Shift Bookings',
                                                          ResourceName,
                                                          Resource
                                                      ) As SB,
                                                      SB.'Team Position'.'Shift Team'.shiftplanner_shiftteam = ShiftTeam.shiftplanner_shiftteam 
                                                      And SB.Date = dteRequestSwapDate_SwapShift.SelectedDate 
                                                      And SB.Resource.'Primary Email' <> varCurrentUser.Email
                                                      And !IsBlank(SB.ResourceName) 
                                                      And ((SB.'Team Position'.Role.Name in varCurrentUserRole And togShowSamePosition_SwapShift.Checked) Or !togShowSamePosition_SwapShift.Checked) 
                                                  )
                                              ),
                                              !IsBlank(WithShiftTeamPosition) And (Name = Self.Selected.Name Or Self.Selected.Name = varAllTeamValue Or IsBlank(Self.Selected.Name))
                                          ),
                                          Name
                                      ));*/

                                      ClearCollect(colTeams,Sort(
                                          Filter(
                                              colMainTeams As Team, (Team.Name = Self.Selected.Name Or Self.Selected.Name = varAllTeamValue Or IsBlank(Self.Selected.Name)) 
                                          ),
                                          Name
                                      ));
                                    Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingRight '
                                    Y: =0.00
                                  Children:
                                    - Name1_1:
                                        Control: ComboBoxDataField@1.5.0
                                        Variant: textualColumn
                                        IsLocked: true
                                        Properties:
                                          FieldDisplayName: ="Name"
                                          FieldName: ="Name"
                                          FieldType: ="s"
                                          Order: =2
            - conGalleries_AllShifts:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  DropShadow: =DropShadow.None
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =24
                  PaddingLeft: =16
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                  Width: =Parent.Width
                Children:
                  - galTeam_AllShifts:
                      Control: Gallery@2.15.0
                      Variant: VariableHeight
                      Properties:
                        AccessibleLabel: ="Teams List"
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FocusedBorderThickness: =0
                        Height: =Parent.Height - conFilter_AllShifts.Height - conMainContent_AllShifts.PaddingTop
                        Items: =colTeams
                        TabIndex: =0
                        TemplatePadding: =0
                        TemplateSize: |-
                          =//100
                          conTeamShiftDetails_AllShifts.Height+galTeamPosition_AllShifts.Height
                        Width: '=Parent.Width - Parent.PaddingLeft '
                      Children:
                        - galTeamPosition_AllShifts:
                            Control: Gallery@2.15.0
                            Variant: Vertical
                            Properties:
                              AccessibleLabel: ="Resource Details"
                              FocusedBorderThickness: =0
                              Height: =((Self.TemplateHeight )*galTeamPosition_AllShifts.AllItemsCount)+12 //Bottom margin
                              Items: "=Sort(\nFilter(\n    AddColumns(\n        'Shift Bookings',\n        ResourceName,\n        Resource\n        \n    ) As SB,\n    SB.Date = dteDate_AllShifts.SelectedDate \n    And SB.'Team Position'.'Shift Team'.shiftplanner_shiftteam = ThisItem.shiftplanner_shiftteam \n    //And SB.Resource.'Primary Email' <> varCurrentUser.Email\n    And !IsBlank(SB.ResourceName) \n    And SB.Status = 'Status (Shift Bookings)'.Active // To filter Active status only\n    And SB.'Status Reason' = 'Status Reason (Shift Bookings)'.Published //865420002 //To filter published only\n    //And ((SB.'Team Position'.Role.shiftplanner_role = varSelectedShift.'Team Position'.Role.shiftplanner_role And togShowSamePosition_SwapShift_1.Checked) Or !togShowSamePosition_SwapShift_1.Checked)\n),Resource.'Last Name')"
                              ShowScrollbar: =false
                              TabIndex: =0
                              TemplatePadding: =0
                              TemplateSize: =60
                              Width: =Parent.Width - 16
                              Y: =101
                            Children:
                              - conTeamProfile_AllShifts:
                                  Control: GroupContainer@1.3.0
                                  Variant: AutoLayout
                                  Properties:
                                    DropShadow: =DropShadow.None
                                    Height: =44
                                    LayoutDirection: =LayoutDirection.Horizontal
                                    LayoutGap: =20
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Width: =Parent.Width
                                  Children:
                                    - conProfileImage_AllShifts:
                                        Control: GroupContainer@1.3.0
                                        Variant: ManualLayout
                                        Properties:
                                          AlignInContainer: =AlignInContainer.SetByContainer
                                          DropShadow: =DropShadow.None
                                          FillPortions: =0
                                          Height: |-
                                            =//Parent.Height
                                            40
                                          LayoutMinHeight: =Parent.Height
                                          LayoutMinWidth: =50
                                          RadiusBottomLeft: =0
                                          RadiusBottomRight: =0
                                          RadiusTopLeft: =0
                                          RadiusTopRight: =0
                                          Width: =40
                                        Children:
                                          - avaResource_AllShifts:
                                              Control: Avatar@1.0.40
                                              Properties:
                                                AccessibleLabel: ="Resource profile picture"
                                                Badge: ='Avatar.Badge'.None
                                                Height: =40
                                                Image: |-
                                                  =If(
                                                      !IsBlank(ThisItem.Resource.'Primary Email') && Office365Users.UserPhotoMetadata(ThisItem.Resource.'Primary Email').HasPhoto,
                                                      Office365Users.UserPhotoV2(ThisItem.Resource.'Primary Email')
                                                  )
                                                Name: =ThisItem.Resource.'Full Name'
                                                Width: =40
                                    - conProfileNameContent_AllShifts:
                                        Control: GroupContainer@1.3.0
                                        Variant: AutoLayout
                                        Properties:
                                          AlignInContainer: =AlignInContainer.SetByContainer
                                          DropShadow: =DropShadow.None
                                          FillPortions: =0
                                          Height: =Parent.Height
                                          LayoutDirection: =LayoutDirection.Vertical
                                          LayoutGap: =4
                                          RadiusBottomLeft: =0
                                          RadiusBottomRight: =0
                                          RadiusTopLeft: =0
                                          RadiusTopRight: =0
                                          Width: |-
                                            =//140
                                            Parent.Width - conProfileImage_AllShifts.Width - 35
                                        Children:
                                          - txtFullname_AllShifts:
                                              Control: Text@0.0.51
                                              Properties:
                                                FontColor: =ColorValue(varTheme.neutralForeground1)
                                                Height: =22
                                                Size: =varThemeFont.H3.size
                                                Text: |+
                                                  =ThisItem.Resource.'Last Name'&", "&ThisItem.Resource.'First Name'

                                                Weight: =varThemeFont.H3.weightBold
                                                Width: =Parent.Width
                                          - txtRoles_AllShifts:
                                              Control: Text@0.0.51
                                              Properties:
                                                FontColor: =ColorValue( varTheme.neutralForeground3)
                                                Height: =22
                                                Text: =ThisItem.'Team Position'.Role.Name
                                                Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                                                Wrap: =false
                        - conTeamShiftDetails_AllShifts:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              DropShadow: =DropShadow.None
                              Height: =txtTeamName_AllShifts.Height+txtShiftName_AllShifts.Height+txtShiftTime_AllShifts.Height + 16 //Padding Bottom
                              LayoutDirection: =LayoutDirection.Vertical
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Width: =Parent.Width
                            Children:
                              - txtTeamName_AllShifts:
                                  Control: Text@0.0.51
                                  Properties:
                                    FontColor: =ColorValue(varTheme.primary)
                                    Height: =Self.Size * 1.5
                                    Size: =20
                                    Text: =ThisItem.Name
                                    VerticalAlign: =VerticalAlign.Top
                                    Weight: =varThemeFont.H3.weightBold
                                    Width: =351
                              - txtShiftName_AllShifts:
                                  Control: Text@0.0.51
                                  Properties:
                                    AutoHeight: =true
                                    FontColor: =ColorValue(varTheme.neutralForeground1)
                                    Text: =ThisItem.'Shift Type'.Name
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =351
                              - txtShiftTime_AllShifts:
                                  Control: Text@0.0.51
                                  Properties:
                                    AutoHeight: =true
                                    FontColor: =ColorValue( varTheme.neutralForeground3)
                                    Text: "= Text(ThisItem.'Shift Type'.Startdate, \"H:mm AM/PM\") & \" - \" & Text(DateAdd(ThisItem.'Shift Type'.Startdate, ThisItem.'Shift Type'.'Duration (hours)',TimeUnit.Hours), \"H:mm AM/PM\") "
                                    Weight: ='TextCanvas.Weight'.Regular
                                    Width: =351
      - cmpHeaderMobile_AllShifts:
          Control: CanvasComponent
          ComponentName: compHeaderMobile
          Properties:
            AllShiftsScreen: ='All Shifts Screen'
            BackScreen: ='Home Screen'
            HeaderTitle: ="All Shifts"
            Height: =104
            HomeScreen: ='Home Screen'
            MyRequestsScreen: ='Request Screen'
            NavigationScreen: ='Navigation Screen'
            ProfileImage: =varCurrentUser.Image
            ProfileScreen: ='Profile Screen'
            TeamsEmbeddedMode: =varIsTeamsEmbedded
            Width: =App.Width

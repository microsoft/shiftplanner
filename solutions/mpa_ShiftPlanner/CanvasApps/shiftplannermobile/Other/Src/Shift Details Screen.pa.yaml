# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Shift Details Screen:
    Properties:
      Fill: =ColorValue(varTheme.neutralBackground2)
    Children:
      - conMainContent_ShiftDetails:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            DropShadow: =DropShadow.None
            Fill: =ColorValue(varTheme.neutralBackground2)
            Height: =Parent.Height - compHeaderMobile_ShiftDetails.Height
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =10
            LayoutOverflowY: =LayoutOverflow.Scroll
            PaddingBottom: =12
            PaddingLeft: |-
              =Switch(App.ActiveScreen.Size,
              5, (App.Width - 1580)/2,
              4, 20,
              3, 20,
              2, 20,
              1, 20
              )
            PaddingRight: |-
              =Switch(App.ActiveScreen.Size,
              5, (App.Width - 1580)/2,
              4, 20,
              3, 20,
              2, 20,
              1, 20
              )
            PaddingTop: =20
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =Parent.Width
            Y: =compHeaderMobile_ShiftDetails.Height
          Children:
            - conBodyContent_ShiftDetails:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  DropShadow: =DropShadow.None
                  Fill: =ColorValue(varTheme.neutralBackground2)
                  FillPortions: =0
                  Height: =Parent.Height - Parent.PaddingTop - Parent.PaddingBottom
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =10
                  LayoutOverflowY: =LayoutOverflow.Scroll
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                  Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingRight '
                  Y: =compHeaderMobile_ShiftDetails.Height + compHeaderMobile_ShiftDetails.Height + 100
                Children:
                  - conHeaderDetails_ShiftDetails:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =txtDateHeader_ShiftDetails.Height + txtDateHeader_ShiftDetails.Height + Self.LayoutGap + txtShiftTime_ShiftDetails.Height + txtPositionLabel_ShiftDetails.Height + Self.PaddingTop + Self.PaddingBottom
                        LayoutDirection: |-
                          =Switch(App.ActiveScreen.Size,
                          5, LayoutDirection.Horizontal,
                          4, LayoutDirection.Horizontal,
                          3, LayoutDirection.Vertical,
                          2, LayoutDirection.Vertical,
                          1, LayoutDirection.Vertical
                          )
                        LayoutGap: =
                        LayoutJustifyContent: =LayoutJustifyContent.Center
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingRight '
                      Children:
                        - txtDateHeader_ShiftDetails:
                            Control: Text@0.0.51
                            Properties:
                              FontColor: =ColorValue(varTheme.neutralForeground1)
                              Size: =varThemeFont.H2.size
                              Text: =Text(varSelectedShift.Date, "mmmm dd, yyyy")
                              VerticalAlign: =VerticalAlign.Top
                              Weight: =varThemeFont.H2.weightBold
                              Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                              X: =5
                        - txtShiftType_ShiftDetails:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Start
                              FillPortions: =0.3
                              FontColor: =ColorValue(varTheme.neutralForeground1)
                              LayoutMinHeight: =20
                              Size: =
                              Text: =varSelectedShift.'Team Position'.'Shift Team'.'Shift Type'.Name
                              VerticalAlign: =VerticalAlign.Top
                              Weight: =varThemeFont.H3.weight
                              Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingRight '
                        - txtShiftTime_ShiftDetails:
                            Control: Text@0.0.51
                            Properties:
                              AutoHeight: =true
                              Text: =Concatenate(Text(varSelectedShift.'Team Position'.'Shift Team'.'Shift Type'.Startdate , DateTimeFormat.ShortTime) & " - " & Text(varSelectedShift.'Team Position'.'Shift Team'.'Shift Type'.Enddate, DateTimeFormat.ShortTime))
                              Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                        - conShiftPosition_ShiftDetails:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              AlignInContainer: =AlignInContainer.Start
                              DropShadow: =DropShadow.None
                              FillPortions: =0
                              Height: =txtPositionLabel_ShiftDetails.Height
                              LayoutDirection: =LayoutDirection.Horizontal
                              Width: =Parent.Width
                            Children:
                              - txtPositionLabel_ShiftDetails:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =20
                                    Text: ="Team Position:"
                                    Weight: =varThemeFont.H3.weightBold
                                    Width: =100
                              - txtTeamPosition_ShiftDetails:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =20
                                    Text: =varSelectedShift.'Team Position'.Role.Name
                                    Width: =Parent.Width - txtPositionLabel_ShiftDetails.Width - Parent.PaddingLeft - Parent.PaddingRight - Parent.LayoutGap
                  - conTeam_ShiftDetails:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =Parent.Height - conHeaderDetails_ShiftDetails.Height - conButtons_ShiftDetails.Height - (Parent.LayoutGap * 3)
                        LayoutDirection: |-
                          =Switch(App.ActiveScreen.Size,
                          5, LayoutDirection.Horizontal,
                          4, LayoutDirection.Horizontal,
                          3, LayoutDirection.Vertical,
                          2, LayoutDirection.Vertical,
                          1, LayoutDirection.Vertical
                          )
                        LayoutGap: =5
                        PaddingBottom: =5
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingRight '
                      Children:
                        - txtTeamName_ShiftDetails:
                            Control: Text@0.0.51
                            Properties:
                              FontColor: =ColorValue(varTheme.primary)
                              Size: =varThemeFont.H2.size
                              Text: =varSelectedShift.'Team Position'.'Shift Team'.Name
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: =varThemeFont.H2.weightBold
                              Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                              X: =5
                        - galTeamMembers_ShiftDetails:
                            Control: Gallery@2.15.0
                            Variant: Vertical
                            Properties:
                              AccessibleLabel: ="Shift Details"
                              BorderStyle: =BorderStyle.None
                              Height: =Parent.Height - txtTeamName_ShiftDetails.Height - Parent.LayoutGap
                              Items: |-
                                =AddColumns(
                                    Filter(
                                        'Team Positions',
                                        ('Effective From' <= varSelectedShift.Date And 'Effective To' >= varSelectedShift.Date) And 'Shift Team'.shiftplanner_shiftteam = varSelectedShift.'Team Position'.'Shift Team'.shiftplanner_shiftteam And Status = 'Status (Team Positions)'.Active
                                    ) As Positions,
                                    ShiftBookingID,
                                        LookUp(
                                            'Shift Bookings',
                                            'Team Position'.shiftplanner_teamposition = Positions.shiftplanner_teamposition And Date = varSelectedShift.Date And Status = 'Status (Shift Bookings)'.Active,
                                            shiftplanner_shiftbooking
                                        ),
                                    ShiftBookingResource,
                                        LookUp(
                                            'Shift Bookings',
                                            'Team Position'.shiftplanner_teamposition = Positions.shiftplanner_teamposition And Date = varSelectedShift.Date And Status = 'Status (Shift Bookings)'.Active,
                                            Resource
                                        )
                                )
                              TabIndex: =0
                              TemplateSize: =40
                              Width: =Parent.Width
                            Children:
                              - conMemberImageDetails_ShiftDetails:
                                  Control: GroupContainer@1.3.0
                                  Variant: AutoLayout
                                  Properties:
                                    DropShadow: =DropShadow.None
                                    Height: =40
                                    LayoutDirection: =LayoutDirection.Horizontal
                                    LayoutGap: =16
                                    Width: =Parent.Width - Self.LayoutGap
                                    X: =1
                                  Children:
                                    - bdgMemberImage_ShiftDetails:
                                        Control: Avatar@1.0.40
                                        Properties:
                                          AccessibleLabel: =Concatenate(txtMemberName_ShiftDetails.Text & "'s user image")
                                          Appearance: ='Avatar.Appearance'.Brand
                                          Badge: ='Avatar.Badge'.None
                                          Height: =Self.Width
                                          Image: |-
                                            =With(
                                                {
                                                    MemberEmail: LookUp(
                                                        'Shift Bookings',
                                                        Resource.'Full Name' = txtMemberName_ShiftDetails.Text
                                                    ).Resource.'Primary Email'
                                                },
                                                If(
                                                    !IsBlank(MemberEmail) && Office365Users.UserPhotoMetadata(MemberEmail).HasPhoto,
                                                    Office365Users.UserPhotoV2(MemberEmail)
                                                )
                                            )
                                          Name: =txtMemberName_ShiftDetails.Text
                                          Width: =32
                                    - conMemberDetails_ShiftDetails:
                                        Control: GroupContainer@1.3.0
                                        Variant: AutoLayout
                                        Properties:
                                          AlignInContainer: =AlignInContainer.SetByContainer
                                          DropShadow: =DropShadow.None
                                          FillPortions: =0
                                          Height: =txtMemberName_ShiftDetails.Height + txtMemberPosition_ShiftDetails.Height + Self.LayoutGap
                                          LayoutDirection: |-
                                            =Switch(App.ActiveScreen.Size,
                                            5, LayoutDirection.Horizontal,
                                            4, LayoutDirection.Horizontal,
                                            3, LayoutDirection.Vertical,
                                            2, LayoutDirection.Vertical,
                                            1, LayoutDirection.Vertical
                                            )
                                          RadiusBottomLeft: =0
                                          RadiusBottomRight: =0
                                          RadiusTopLeft: =0
                                          RadiusTopRight: =0
                                          Width: =Parent.Width - bdgMemberImage_ShiftDetails.Width - Parent.PaddingLeft - Parent.PaddingRight - Parent.LayoutGap
                                        Children:
                                          - txtMemberName_ShiftDetails:
                                              Control: Text@0.0.51
                                              Properties:
                                                Align: ='TextCanvas.Align'.Start
                                                FontColor: =ColorValue(varTheme.neutralForeground1)
                                                Height: =20
                                                Size: =
                                                Text: |-
                                                  =If(
                                                      IsBlank(
                                                          ThisItem.ShiftBookingResource.'Primary Email'
                                                      ),
                                                      "(Not filled)",
                                                      ThisItem.ShiftBookingResource.'Full Name' 
                                                  )
                                                VerticalAlign: =VerticalAlign.Top
                                                Weight: =varThemeFont.H3.weightBold
                                                Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingRight '
                                          - txtMemberPosition_ShiftDetails:
                                              Control: Text@0.0.51
                                              Properties:
                                                Align: ='TextCanvas.Align'.Start
                                                FontColor: =ColorValue(varTheme.neutralForeground3)
                                                Height: =20
                                                Text: =ThisItem.Role.Name
                                                VerticalAlign: =VerticalAlign.Top
                                                Weight: =
                                                Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingRight '
                  - conButtons_ShiftDetails:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        DropShadow: =DropShadow.None
                        FillPortions: =0
                        Height: =32
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =5
                        LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                        Width: '=Parent.Width - Parent.PaddingLeft - Parent.PaddingRight '
                      Children:
                        - btnRequestTimeOff_ShiftDetails:
                            Control: Button@0.0.45
                            Properties:
                              AccessibleLabel: ="Shift Team Details"
                              Appearance: ='ButtonCanvas.Appearance'.Secondary
                              DisplayMode: |+
                                =With(
                                    {wHasRow: CountRows(Filter('Change Requests' As CR, 
                                     CR.Resource.'Primary Email' = varSelectedShift.Resource.'Primary Email' &&  
                                     CR.'Change Type' = 'Change type'.'Time off' &&
                                     CR.'Shift Booking'.Date = varSelectedShift.Date &&
                                     CR.'Status Reason' = 'Status Reason (Change Requests)'.'Pending Approval')) },
                                     If(wHasRow,DisplayMode.Disabled,DisplayMode.Edit)
                                )
                              FillPortions: =1
                              OnSelect: =Navigate('Request Time Off Screen',ScreenTransition.None);
                              Text: ="Request time off"
                              Visible: =If(varSelectedShift.Date < Today(), false, true) // Temporary hidden for midsprint demo
                              Width: =172
                        - btnSwapShift_ShiftDetails:
                            Control: Button@0.0.45
                            Properties:
                              AccessibleLabel: ="Swap Shift"
                              Appearance: ='ButtonCanvas.Appearance'.Secondary
                              FillPortions: =1
                              OnSelect: =Navigate('Swap Shift Screen')
                              Text: ="Swap shift"
                              Visible: =If(varSelectedShift.Date < Today(), false, true)
                              Width: =172
                        - btnBack_ShiftDetails:
                            Control: Button@0.0.45
                            Properties:
                              AccessibleLabel: ="Back Button"
                              Appearance: ='ButtonCanvas.Appearance'.Secondary
                              FillPortions: =1
                              OnSelect: =Navigate('Home Screen', ScreenTransition.Fade)
                              Text: ="Back"
                              Visible: =If(varSelectedShift.Date < Today(), true, false)
                              Width: =172
      - compHeaderMobile_ShiftDetails:
          Control: CanvasComponent
          ComponentName: compHeaderMobile
          Properties:
            AllShiftsScreen: ='All Shifts Screen'
            BackScreen: ='Home Screen'
            HeaderTitle: ="Shift Details"
            Height: =104
            HomeScreen: ='Home Screen'
            MyRequestsScreen: ='Request Screen'
            NavigationScreen: ='Navigation Screen'
            ProfileImage: =varCurrentUser.Image
            ProfileScreen: ='Profile Screen'
            TeamsEmbeddedMode: =varIsTeamsEmbedded
            Width: =App.Width
